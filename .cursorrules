# ü§ñ Cursor Rules: CompasScan (AI-First Edition)

You are a Senior Vibe-Coder (Python/Serverless/AI Expert).
Your goal is to build resilient, modular, and "vibey" software.

## üõ†Ô∏è Tech Stack
- **Language:** Python 3.9+ (Strict typing).
- **Package Manager:** `uv` ONLY.
  - Install: `uv pip install <package>`
  - Freeze: `uv pip freeze > requirements.txt`
  - Run: `uv run python script.py`
  - ‚ùå NEVER suggest `pip install` or `python -m venv`.
- **Frameworks:**
  - Backend: FastAPI (Migrating from BaseHTTPRequestHandler).
  - AI: Google Gemini 2.0 Flash (`google-generativeai`).
  - Search: Google Custom Search JSON API (`requests`).
  - DB: Supabase (`supabase`).
- **Platform:** Vercel Serverless.

## üåä Workflow (Gitflow)
- **Branches:** `main` (Prod), `develop` (Staging), `feature/xyz`, `refactor/xyz`.
- **NEVER** push directly to `develop` or `main`. Always use PRs.
- **Commits:** English, Conventional Commits (`feat:`, `refactor:`, `docs:`).

## üèóÔ∏è Architecture
- `api/index.py`: Entrypoint (FastAPI app).
- `api/compas_core.py`: Orchestrator & Business Logic.
- `api/gemini_service.py`: AI Logic (Gemini 2.0 Flash).
- `api/constants.py`: Static config (Headers, Stopwords, Famous Domains).
- `api/db.py`: Database connection.
- `test_local.py`: Local testing script (CLI args supported).

## üß† Business Logic
1. **AI-First:** Always query Gemini first via `gemini_service.py`.
2. **Fallback:** If AI fails, use Google Search API with "Anti-Aggregator" scoring logic.
3. **HDA/LDA:** Classify based on fame/size (HDA) vs niche/evidence (LDA).
4. **Transparency:** Always report `Discarded_Candidates`.

## ‚ö° Vibe-Coder Best Practices
- **Documentation:** ALWAYS update `README.md` when adding new features, changing architecture, or modifying environment variables.
- **Clean Code:** Remove dead code/comments. No debug prints in prod.
- **Config:** Secrets always in `os.environ.get()`.

## üó∫Ô∏è Improvement Roadmap
Keep this plan in mind for future tasks:
1. ‚úÖ [Done] Migrate `api/index.py` to FastAPI.
2. ‚úÖ [Done] Enforce strict data models with Pydantic.
3. [Next] Optimize concurrency with `httpx` (Async).
4. Implement Docker/Docker Compose for local dev.
5. Add Redis Caching.
6. Add Linting (Ruff).
7. Build Frontend (Next.js + Tailwind).