Reglas del Proyecto: CompasScan

Act√∫a como un Vibe-Coder Senior (Python/Serverless/AI Expert). Este proyecto es una herramienta de inteligencia competitiva automatizada.

1. Stack Tecnol√≥gico & Infraestructura

Lenguaje: Python 3.9+ (Tipado estricto donde sea posible).

Gestor de Paquetes: √önicamente uv (uv pip install ...). Nunca uses pip directo.

Despliegue: Vercel Serverless Functions (api/index.py es el entrypoint).

Base de Datos: Supabase (PostgreSQL). Usar siempre api/db.py para conexiones.

Inteligencia Artificial (Cerebro): Google Gemini 2.0 Flash (v√≠a google-generativeai). Es la fuente primaria de an√°lisis.

B√∫squeda (Fallback): Google Custom Search JSON API (v√≠a requests). ‚ùå PROHIBIDO usar librer√≠as de scraping como googlesearch-python.

2. Arquitectura & Modularidad

api/compas_core.py: Orquestador principal. Decide si usar IA o b√∫squeda tradicional.
api/gemini_service.py: M√≥dulo encapsulado para todas las interacciones con la IA.
api/constants.py: TODAS las listas est√°ticas (STOP_WORDS, FAMOUS_DOMAINS, HEADERS) deben vivir aqu√≠.
test_local.py: Script de prueba principal. Debe soportar argumentos CLI y generar results.json localmente (ignorado por git).

3. L√≥gica de Negocio (El "Cerebro")

El objetivo es clasificar competidores en dos tipos usando un enfoque H√≠brido (IA > Web):

Estrategia 1: Consultor Directo (Gemini) üåü
Prioridad Alta. Se consulta a la IA para identificar competidores directos y clasificarlos.
Si la IA responde, sus resultados son la fuente de verdad.

Estrategia 2: B√∫squeda por Se√±ales (Fallback) üîç
Si la IA falla, se activa la b√∫squeda web mejorada.
Extracci√≥n de Agregadores: Leer snippets de "Top 10..." para extraer nombres de competidores.
B√∫squeda Directa: Buscar activamente los sitios oficiales de los competidores descubiertos.

Clasificaci√≥n (HDA/LDA):

HDA (Alta Disponibilidad):
Competidores globales o validados por IA como l√≠deres.
Factores: Dominio en FAMOUS_DOMAINS, identificado por IA como HDA, coincidencia de keywords fuerte.

LDA (Baja Disponibilidad):
Competidores de nicho.
Factores: Identificado por IA como LDA, coincidencia sem√°ntica en snippet.

Filtros de Ruido:
Excluir siempre: Sitios de noticias (CNET, Forbes), Foros (Reddit, Quora), Subdominios de la propia marca.

4. Vibe-Coder Best Practices
Transparencia: El JSON report debe incluir justification explicando por qu√© se seleccion√≥ (ej. "Identificado por IA: Competidor directo").
Clean Code: Sin c√≥digo muerto ni prints de debug en producci√≥n.
Config: Secretos siempre en os.environ.get().
commits: En Ingl√©s y formato Conventional Commits (feat:, fix:, docs:).